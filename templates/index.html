{% extends 'base.html' %}

{% block head %}
<title>MIXOLOGIST</title>
{% endblock %}

{% block body %}
<div class="content">
    <h1>MIXOLOGIST</h1>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <p class = "{{ category }}">{{ message }}</p>
            {% endfor %}
        {% endif %}
    {% endwith %}


    <div class ="form-container">
        <form action ="/" method ='POST'>
            <h3> Enter the name of your drink</h3>
                <label for="name"> Drink Name: </label>
                <input type ="text" name ="name" required>

            <br>

            <h3> Enter all the ingredients</h3>
                <label> Ingredients: </label>
                <input type="text" id="ingredient_input"
                <button type="button" id="add_ingredient_btn"> Add Ingredient</button>
                <!-- Bulleted List of added ingredients-->
                <ul id="ingredients_display"></ul>
                <!-- Hide the input, but store the ingredient list-->
                <input type="hidden" name ="ingredients" id="ingredients_hidden">

                <br><br>

            <button type="submit"> Create Drink</button>
        </form>
    </div>

    <h2> Previous Drinks: </h2>
    {% if drinks %}
        <ul>
             {% for drink in drinks %}
                <li>
                    <strong> {{ drink.name }}</strong>
                    <ul>
                        {% for ingredient in drink.get_ingredients() %}
                            <li> {{ ingredient }}</li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p> No drinks created yet. Start mixing!</p>
    {% endif %}
</div>

<!-- JAVASCRIPT -->   
<script>

    let ingredients = [];

    document.GetElementById("add_ingredient_button").addEventListener("click", function() {
        // Make the variables javascript form
        let ingredientInput = document.getElementById('ingredient_input');
        let ingredient = ingredientInput.value.trim();

        // If the input is empty 
        if (ingredient === "") {
            alert("Please add an ingredient!");
            return;
        }
        // NO MORE THAN 50 INGREDIENTS - Limit ingredient list to 50 ingredients
        if (ingredients.length >= 50) {
            alert("STOP! No more than 50 ingredients! You might die!");
            return;
        }

        // Store the ingredient as a full word
        ingredients.push(ingredient);
        // Clear the input box thing
        ingredientInput.value="";
        
        // UPDATE hidden ingredient input
        document.getElementById('ingredients_hidden').value =JSON.stringify(ingredients)
        // UPDATE dispalyed ingredient list
        let ingredients_list = document.getElementById("ingredients_display");
        list.innerHTML = "";

        ingredients.forEach(ing => {
            let point = document.createElement("li")
            point.textContent = ing;
            ingredients_list.appendChild(point);
        });
    });
</script>

{% endblock %}


